<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ACEsimFit • ACEsimFit</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ACEsimFit">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ACEsimFit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/ACEsimFit.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>ACEsimFit</h1>
            
      

      <div class="d-none name"><code>ACEsimFit.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ACEsimFit</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This package is designed for 1) Simulating kin pairs data based on
the assumption that every trait is affected by genetic effects (A),
common environmental effects (C) and unique environmental effects (E).
2) Using kin pairs data to fit an ACE model and get model fit output. In
our vignette, we will use height as a trait to demonstrate how people
can simulate kin pairs of height data and how to use those simulated
data to fit a univariate ACE model. We will also discuss the possible
ways to analyse these model fitting results. 3) Calculate power of
heritability estimate given a specific condition. (Note: The ideas and
data in this vignette are only for demonstration purpose and can be
inaccurate in terms of the true facts in science.)</p>
</div>
<div class="section level2">
<h2 id="simulate-kin-pair-data">Simulate kin pair data<a class="anchor" aria-label="anchor" href="#simulate-kin-pair-data"></a>
</h2>
<p>Suppose we have a situation like this: I wants to investigate what
factors impact the height of the adults in a non-European country.
Researchers in developed countries like US and UK have collected a sea
of twin data to explore the question and reached a conclusion: 60% of
variance of height comes from genes, 20% of variance comes from family
environment and 20% comes from personal environment and error. I wanted
to see if this conclusion holds true in an Asian country. One approach
is to use a public dataset with height measure and family structure
records.</p>
<p>However, the dataset has two problems: 1) Only have 180 pairs of
twins 2) can only distinguish MZ twins and same-sex DZ twins. Given the
problems this dataset had, it will be useful to do a priori power
analysis to check the statistical power of my study.</p>
<p>So first I need to simulate data which they have same variance and
covariance structure as the data in the public dataset. We can use the
<code>kinsim_double</code> function to do that. Here’s some conditions I
want to replicate:</p>
<ul>
<li><p>Sample sizes: 60 pairs of opposite-sex DZ twins (genetic
relatedness is .5) and 120 pairs of same-sex MZ and DZ twins (genetic
relatedness is .75)</p></li>
<li><p>The relatedness of .75 is achieved by combining MZ and DZ twins
instead of simulating kin pairs with relatedness of .75
directly.</p></li>
<li><p>ACE variance structure: A = .6, C = .2, E = .2</p></li>
<li><p>Group mean is both 0, because they should be Z scores.</p></li>
</ul>
<p>Therefore, we set the parameters of the <code>kinsim_double</code>
function like below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kindata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kinsim_double.html">kinsim_double</a></span><span class="op">(</span></span>
<span>  GroupNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SStwins"</span>, <span class="st">"OStwins"</span><span class="op">)</span>,</span>
<span>  GroupSizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">60</span><span class="op">)</span>,</span>
<span>  GroupRel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.75</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  GroupR_c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  ace1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.2</span>, <span class="fl">.2</span><span class="op">)</span>,</span>
<span>  ace2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.2</span>, <span class="fl">.2</span><span class="op">)</span>,</span>
<span>  ifComb <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kindata</span><span class="op">)</span></span>
<span><span class="co">#&gt;    GroupName    R r_c id          A1          A2          C1          C2</span></span>
<span><span class="co">#&gt; 48   SStwins 0.75   1  1  0.02248168  0.02248168 -0.03448461 -0.03448461</span></span>
<span><span class="co">#&gt; 66   SStwins 0.75   1  2  0.87922301  0.73493224 -0.42473098 -0.42473098</span></span>
<span><span class="co">#&gt; 47   SStwins 0.75   1  3 -0.28043976 -0.28043976 -0.25064124 -0.25064124</span></span>
<span><span class="co">#&gt; 14   SStwins 0.75   1  4 -0.76368579 -0.76368579 -0.59577363 -0.59577363</span></span>
<span><span class="co">#&gt; 16   SStwins 0.75   1  5 -0.73345621 -0.73345621  0.18573124  0.18573124</span></span>
<span><span class="co">#&gt; 95   SStwins 0.75   1  6 -0.01048472 -0.06118696  0.19529037  0.19529037</span></span>
<span><span class="co">#&gt;             E1          E2          y1         y2</span></span>
<span><span class="co">#&gt; 48  0.09741996 -0.19555812  0.08541702 -0.2075610</span></span>
<span><span class="co">#&gt; 66 -0.49639316 -0.41603625 -0.04190114 -0.1058350</span></span>
<span><span class="co">#&gt; 47 -0.42105074 -0.03581002 -0.95213174 -0.5668910</span></span>
<span><span class="co">#&gt; 14 -0.33618089 -0.81363682 -1.69564031 -2.1730962</span></span>
<span><span class="co">#&gt; 16 -0.37056277  0.01884294 -0.91828774 -0.5288820</span></span>
<span><span class="co">#&gt; 95  0.39216748 -0.67556163  0.57697313 -0.5414582</span></span></code></pre></div>
<p>Now you can see we have a data.frame with 180 pairs of simulated
twins. And we also have their variance components and other
information.</p>
</div>
<div class="section level2">
<h2 id="calculate-the-power-of-the-heritability-estimate-given-the-variance-structure">Calculate the power of the heritability estimate given the variance
structure<a class="anchor" aria-label="anchor" href="#calculate-the-power-of-the-heritability-estimate-given-the-variance-structure"></a>
</h2>
<p>Generally, calculating power for the A estimate had two approaches:
likelihood theory and the least squares theory.</p>
<div class="section level3">
<h3 id="calculate-power-based-on-likelihood-theory">Calculate power based on likelihood theory<a class="anchor" aria-label="anchor" href="#calculate-power-based-on-likelihood-theory"></a>
</h3>
<p>To use the likelihood theory, we need to simulate a number of
datasets with the same variance structure and average the suggested
power from each set of data. See a more detailed explanation at <a href="http://www.people.vcu.edu/~bverhulst/power/power.html" class="external-link">link</a>.
So we need to have a set of model fitting results with the -2ll values
for the ACE model and the CE model.</p>
<p>Luckily, in our package they have a function <code>Sim_Fit</code> to
simulate kin pairs data, fit them automatically into a ACE model and
return the model summary results. The function fit the ACE model with
the help of <code>OpenMx</code> package.</p>
<p>Here, we again assigned the same parameters to the function. There
are a few new parameters here:</p>
<ul>
<li>We want 50 simulated datasets so my power calculation can be
relatively accurate. So we set the <code>nIter = 50</code>. Set more
iterations when you want to get a even more accurate power.</li>
<li>We hope my simulated results can be replicated so we set
<code>SSeed = 62</code>. Pick a lucky number here!</li>
<li>We don’t want to contrain the estimation so we set
<code>lbound = FALSE</code>.</li>
<li>We don’t need the raw data since they will eat up my poor-RAM
laptop. So we set <code>saveRaw = FALSE</code>.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">results_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Sim_Fit.html">Sim_Fit</a></span><span class="op">(</span></span>
<span>  GroupNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SStwins"</span>, <span class="st">"OStwins"</span><span class="op">)</span>,</span>
<span>  GroupSizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">60</span><span class="op">)</span>,</span>
<span>  nIter <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  SSeed <span class="op">=</span> <span class="fl">62</span>,</span>
<span>  GroupRel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.75</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  GroupR_c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  ace1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.2</span>, <span class="fl">.2</span><span class="op">)</span>,</span>
<span>  ace2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.2</span>, <span class="fl">.2</span><span class="op">)</span>,</span>
<span>  ifComb <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lbound <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  saveRaw <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">time2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## FYI, the time used for the results above is here. So design your simulation wisely!!!</span></span>
<span><span class="va">time2</span> <span class="op">-</span> <span class="va">time1</span></span>
<span><span class="co">#&gt; Time difference of 42.67797 secs</span></span></code></pre></div>
<p>Here’s one example of the nested comparison table from the
results</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_fit</span><span class="op">[[</span><span class="st">"Iteration1"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Results"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"nest"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;            base comparison ep minus2LL  df      AIC     diffLL diffdf</span></span>
<span><span class="co">#&gt; 1 oneACEvc_1cov       &lt;NA&gt;  4 896.1042 356 904.1042         NA     NA</span></span>
<span><span class="co">#&gt; 2 oneACEvc_1cov    oneAEvc  3 897.0780 357 903.0780  0.9737667      1</span></span>
<span><span class="co">#&gt; 3 oneACEvc_1cov    oneCEvc  3 898.0232 357 904.0232  1.9190034      1</span></span>
<span><span class="co">#&gt; 4 oneACEvc_1cov     oneEvc  2 980.2935 358 984.2935 84.1892959      2</span></span>
<span><span class="co">#&gt;              p</span></span>
<span><span class="co">#&gt; 1           NA</span></span>
<span><span class="co">#&gt; 2 3.237426e-01</span></span>
<span><span class="co">#&gt; 3 1.659666e-01</span></span>
<span><span class="co">#&gt; 4 5.230301e-19</span></span></code></pre></div>
<p>We can then calculated the weighted ncp with the average difference
of log-likelihood for ACE and CE models.In turn, I calculated the power
for the given variance structure and relatedness:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">180</span> <span class="co">## the total number of kin pairs you used in your previous simulation</span></span>
<span><span class="co">## Calculate the average diffLL between ACE and CE model.</span></span>
<span><span class="va">DiffLL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">DiffLL</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">results_fit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Results"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"nest"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">diffLL</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">meanDiffLL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">DiffLL</span><span class="op">)</span></span>
<span><span class="co">## Calculate the power based on an alpha level of .05</span></span>
<span><span class="va">Power</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">pchisq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">qchisq</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">.05</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">meanDiffLL</span><span class="op">)</span></span>
<span><span class="va">Power</span></span>
<span><span class="co">#&gt; [1] 0.2831639</span></span></code></pre></div>
<p>So you can see the power for my model would be insufficient to have a
confident estimate of height heritability. :(</p>
</div>
<div class="section level3">
<h3 id="calculate-power-based-on-least-squares-theory">Calculate power based on least squares theory<a class="anchor" aria-label="anchor" href="#calculate-power-based-on-least-squares-theory"></a>
</h3>
<p>Unlike the likelihood theory, we don’t need to run simulations to
calculate power because we can have a formula in Xuanyu and Mason’s
paper (submitted; you will see a link here soon). The function
<code>Power_LS</code> is designed for power calculation based on LS
theory.</p>
<p>Here I typed the parameters my research question involved into the
functions.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Power_LS.html">Power_LS</a></span><span class="op">(</span>N1 <span class="op">=</span> <span class="fl">120</span>, N2 <span class="op">=</span> <span class="fl">60</span>, h2 <span class="op">=</span> <span class="fl">.6</span>, c2 <span class="op">=</span> <span class="fl">.2</span>, R1 <span class="op">=</span> <span class="fl">.75</span>, R2 <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3881047</span></span></code></pre></div>
<p>Your can see the power calculated with LS theory is different from
the one with likelihood theory. This is due to 1) with the LS formula,
we did’t consider the combination of MZ and DZ twins to reach a
relatedness of .75 2) they will be different especially when the sample
size is small. In our case, if we have 1800 pairs in stead of 180, the
power from likelihood theory will be 0.9890003 and the power from least
squares theory will be 0.9960664. (Much more similar at this time!)</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xuanyu Lyu, S.Mason Garrison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
